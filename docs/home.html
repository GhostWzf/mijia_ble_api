
                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    <head>
        <title>查看源</title>
        <link rel="canonical" href="/pages/viewpage.action?pageId=$action.page.id" />
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\u0022\u0022";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script>
<link type="text/css" rel="stylesheet" href="/s/dba054264c6a0c1425b5ffebae0b3405-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/e860d0fc70e2f6d6e8992c9ce453f407/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/dba054264c6a0c1425b5ffebae0b3405-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/e860d0fc70e2f6d6e8992c9ce453f407/_/download/contextbatch/css/_super/batch.css?conditionalComment=lt+IE+9" data-wrm-key="_super" data-wrm-batch-type="context" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/dba054264c6a0c1425b5ffebae0b3405-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/e860d0fc70e2f6d6e8992c9ce453f407/_/download/contextbatch/css/_super/batch.css?conditionalComment=lte+IE+9" data-wrm-key="_super" data-wrm-batch-type="context" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/02750b92df9e231190e9ec94c8f7a148/_/download/contextbatch/css/plugin.viewsource,-_super/batch.css" data-wrm-key="plugin.viewsource,-_super" data-wrm-batch-type="context" media="all">
<link type="text/css" rel="stylesheet" href="/s/a2fe3d9fc9c4f868b370b15b14e137af-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/7f39c367ccf08f16fd3c691b098825f8/_/download/contextbatch/css/page,-_super/batch.css" data-wrm-key="page,-_super" data-wrm-batch-type="context" media="all">
<link type="text/css" rel="stylesheet" href="/s/5333d01b74d28ccfa1b186a79244abaf-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/cb07a627745ab9a30a1546f44525f066/_/download/contextbatch/css/editor-content,-_super/batch.css?confluence.table.resizable=true&amp;confluence.view.edit.transition=true" data-wrm-key="editor-content,-_super" data-wrm-batch-type="context" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/5333d01b74d28ccfa1b186a79244abaf-CDN/zh_CN/7111/583f3f4010922d699723a091097524472954c767/cb07a627745ab9a30a1546f44525f066/_/download/contextbatch/css/editor-content,-_super/batch.css?conditionalComment=lte+IE+9&amp;confluence.table.resizable=true&amp;confluence.view.edit.transition=true" data-wrm-key="editor-content,-_super" data-wrm-batch-type="context" media="all">
<![endif]-->

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <h2>简介</h2><hr /><p>MIBLE底层通用接口，是对蓝牙BLE协议栈的封装，与各硬件平台和协议栈解绑。 米家蓝牙BLE的所有应用将构建在此套接口之上。米家BLE软件层次架构如下图所示。</p><p><img class="confluence-embedded-image" src="/download/attachments/64161957/image2017-11-20_11-39-22.png?version=1&amp;modificationDate=1511149923000&amp;api=v2" data-image-src="/download/attachments/64161957/image2017-11-20_11-39-22.png?version=1&amp;modificationDate=1511149923000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="64161899" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-11-20_11-39-22.png" data-base-url="http://wiki.n.miui.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="64161957" data-linked-resource-container-version="10" title="Miot 嵌入式 > MIBLE 底层通用接口 > image2017-11-20_11-39-22.png" data-location="Miot 嵌入式 > MIBLE 底层通用接口 > image2017-11-20_11-39-22.png" data-image-height="637" data-image-width="1484"></p><h2>代码链接</h2><hr /><p><a href="https://github.com/MiEcosystem/mijia_ble_api">https://github.com/MiEcosystem/mijia_ble_api</a></p><p>其中 release-1.0 分支为 MIBLE 底层接口定义。 其余分支为各芯片公司对接口的实现。</p><h2>函数列表</h2><hr /><table class="wrapped confluenceTable"><colgroup><col style="width: 98.0px;" /><col style="width: 316.0px;" /><col style="width: 297.0px;" /><col style="width: 120.0px;" /><col style="width: 130.0px;" /><col style="width: 861.0px;" /></colgroup><tbody><tr><th style="text-align: left;" class="confluenceTh">类别</th><th style="text-align: left;" class="confluenceTh">函数名</th><th style="text-align: left;" class="confluenceTh">含义</th><th colspan="1" class="confluenceTh">支持米家标准接入协议</th><th colspan="1" class="confluenceTh">支持米家蓝牙锁接入协议以及蓝牙MESH协议</th><th style="text-align: left;" colspan="1" class="confluenceTh">说明</th></tr><tr><td style="text-align: left;" rowspan="4" class="confluenceTd">事件回调函数</td><td style="text-align: left;" class="confluenceTd">mible_gap_event_callback</td><td style="text-align: left;" class="confluenceTd">GAP 相关回调函数</td><td colspan="1" class="confluenceTd">√</td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" rowspan="4" class="confluenceTd"><p>各平台底层需支持回调函数（在合适的地方调用），上层应用负责实现回调函数内的内容</p></td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gatts_event_callback</td><td style="text-align: left;" class="confluenceTd">GATT Server 相关回调函数</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gattc_event_callback</td><td style="text-align: left;" class="confluenceTd">GATT Client 相关回调函数</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_arch_event_callback</td><td style="text-align: left;" class="confluenceTd">MIBLE 接口相关回调函数</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td></tr><tr><td style="text-align: left;" rowspan="9" class="confluenceTd">GAP 相关 API</td><td style="text-align: left;" class="confluenceTd">mible_gap_address_get</td><td style="text-align: left;" class="confluenceTd">获得本地 MAC 地址</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">小端对齐</td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gap_scan_start</td><td style="text-align: left;" class="confluenceTd">设置扫描参数，并开启扫描</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td><td style="text-align: left;" colspan="1" class="confluenceTd">扫描到的数据通过MIBLE_GAP_EVT_ADV_REPORT事件通知应用层</td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gap_scan_stop</td><td style="text-align: left;" class="confluenceTd">扫描结束</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td><td style="text-align: left;" colspan="1" class="confluenceTd"><br /></td></tr><tr><td colspan="1" class="confluenceTd">mible_gap_adv_start</td><td colspan="1" class="confluenceTd">广播开始</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd">可以重复开启</td></tr><tr><td colspan="1" class="confluenceTd">mible_gap_adv_data_set</td><td colspan="1" class="confluenceTd">设置广播数据</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td colspan="1" class="confluenceTd">mible_gap_adv_stop</td><td colspan="1" class="confluenceTd">广播结束</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gap_connect</td><td style="text-align: left;" class="confluenceTd">设置连接参数并启动连接</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">连接成功后，通过MIBLE_GAP_EVT_CONNECTED事件通知应用层</td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gap_disconnect</td><td style="text-align: left;" class="confluenceTd">断开连接</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">断开连接后，通过MIBLE_GAP_EVT_DISCONNECT事件通知应用层</td></tr><tr><td style="text-align: left;" class="confluenceTd">mible_gap_update_conn_params</td><td style="text-align: left;" class="confluenceTd">更新连接参数</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">更新连接参数完成后，通过MIBLE_GAP_EVT_CONN_PARAM_UPDATE事件通知应用层</td></tr><tr><td style="text-align: left;" rowspan="5" class="confluenceTd">GATTS 相关 API</td><td style="text-align: left;" class="confluenceTd">mible_gatts_service_init</td><td style="text-align: left;" class="confluenceTd">属性服务器初始化</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><p>属性服务及特征的初始化。异步操作，初始化成功后，通过MIBLE_ARCH_EVT_GATTS_SRV_INIT_CMP事件通知应用层。</p><p>注意：1、通过函数参数mible_gatts_db_t 类型指针指向的初始化空间，仅仅用于初始化，初始化完成后会由应用层释放调。2、<span>参数中部分用于[OUT]，服务和特性的handle为输出量。</span></p></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gatts_value_set</td><td style="text-align: left;" colspan="1" class="confluenceTd">设置本地属性</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">注意参数中部分用于[OUT]</td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gatts_value_get</td><td style="text-align: left;" colspan="1" class="confluenceTd">获取本地属性</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><span>注意参数中部分用于[OUT]</span></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gatts_notify_or_indicate</td><td style="text-align: left;" colspan="1" class="confluenceTd">设置char的值并且发送 notification 或 indication</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><br /></td></tr><tr><td colspan="1" class="confluenceTd">mible_gatts_rw_auth_reply</td><td colspan="1" class="confluenceTd">读写回复</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd">此函数用于带permission的读写操作的回复。</td></tr><tr><td style="text-align: left;" rowspan="6" class="confluenceTd">GATTC 相关 API</td><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gattc_primary_service_discover_by_uuid</td><td style="text-align: left;" colspan="1" class="confluenceTd">通过 UUID 的主服务发现</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td><td style="text-align: left;" rowspan="6" class="confluenceTd">蓝牙BLE单模设备，暂时不需要支持此部分。<br /><br /><br /><br /><br /><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gattc_char_discover_by_uuid</td><td style="text-align: left;" colspan="1" class="confluenceTd">通过 UUID 的特性发现</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gattc_clt_cfg_descriptor_discover</td><td style="text-align: left;" colspan="1" class="confluenceTd">CCCD 发现</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gattc_read_char_value_by_uuid</td><td style="text-align: left;" colspan="1" class="confluenceTd">通过 <span>UUID </span>读取特性值</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gattc_write_with_rsp</td><td style="text-align: left;" colspan="1" class="confluenceTd">有回复的写入</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_gattc_write_cmd</td><td style="text-align: left;" colspan="1" class="confluenceTd">无回复的写入</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" rowspan="4" class="confluenceTd">Timer 相关 API</td><td style="text-align: left;" colspan="1" class="confluenceTd">mible_timer_create</td><td style="text-align: left;" colspan="1" class="confluenceTd">创建一个 软件定时器</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_timer_delete</td><td style="text-align: left;" colspan="1" class="confluenceTd">删除一个 <span>软件定时器</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_timer_start</td><td style="text-align: left;" colspan="1" class="confluenceTd">开启<span>软件定时器</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">可重复开启</td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_timer_stop</td><td style="text-align: left;" colspan="1" class="confluenceTd">停止<span>软件定时器</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><br /></td></tr><tr><td style="text-align: left;" rowspan="4" class="confluenceTd">Flash 相关 API</td><td style="text-align: left;" colspan="1" class="confluenceTd">mible_record_create</td><td style="text-align: left;" colspan="1" class="confluenceTd">创建一条记录</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><span>至少支持8个record id的管理，总大小不超过4k。同步操作</span></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_record_delete</td><td style="text-align: left;" colspan="1" class="confluenceTd">删除一条记录</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><span>同步操作</span></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_record_read</td><td style="text-align: left;" colspan="1" class="confluenceTd">读一条记录</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><span>同步操作</span></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_record_write</td><td style="text-align: left;" colspan="1" class="confluenceTd">写入一条记录</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">异步操作，写flash完成后，</td></tr><tr><td style="text-align: left;" rowspan="8" class="confluenceTd">其他<br /><br /><br /><br /></td><td style="text-align: left;" colspan="1" class="confluenceTd">mible_rand_num_generator</td><td style="text-align: left;" colspan="1" class="confluenceTd">获得真随机数</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">随机数生成器</td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_aes128_encrypt</td><td style="text-align: left;" colspan="1" class="confluenceTd">AES-128加密</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">对16字节数据进行AES加密，不足16字节，用0补全。<span>注意参数中部分用于[OUT]</span></td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_task_post</td><td style="text-align: left;" colspan="1" class="confluenceTd">将非实时性函数加入任务队列（协议栈选择在合适位置执行）</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd">有任务调度的平台可以通过创建一个低优先级任务执行应用层函数；没有任务调度的平台可以在主函数while(1)中进入低功耗模式前执行。</td></tr><tr><td style="text-align: left;" colspan="1" class="confluenceTd">mible_task_exec</td><td style="text-align: left;" colspan="1" class="confluenceTd">执行任务队列中的函数</td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>√</span></td><td style="text-align: left;" colspan="1" class="confluenceTd"><br /></td></tr><tr><td colspan="1" class="confluenceTd">mible_iic_init</td><td colspan="1" class="confluenceTd">初始化IIC驱动</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td colspan="1" class="confluenceTd">mible_iic_uninit</td><td colspan="1" class="confluenceTd">反初始化</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><br /></td></tr><tr><td colspan="1" class="confluenceTd">mible_iic_tx</td><td colspan="1" class="confluenceTd">向IIC slave发送数据</td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd">非阻塞实现</td></tr><tr><td colspan="1" class="confluenceTd">mible_iic_rx</td><td colspan="1" class="confluenceTd">从<span>IIC slave接收数据</span></td><td colspan="1" class="confluenceTd"><br /></td><td colspan="1" class="confluenceTd"><span>√</span></td><td colspan="1" class="confluenceTd"><span>非阻塞实现</span></td></tr></tbody></table>
        <p>&nbsp;</p>
    </body>
</html>
